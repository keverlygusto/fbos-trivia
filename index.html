<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pop Culture Trivia Challenge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #F45D48 0%, #E94B35 100%);
            min-height: 100vh;
            padding: 40px 20px;
            color: #1a1a1a;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 48px;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            margin-bottom: 24px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        h1 {
            color: #1a1a1a;
            margin-bottom: 12px;
            text-align: center;
            font-size: 48px;
            font-weight: 800;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        h2 {
            color: #1a1a1a;
            margin-bottom: 24px;
            font-size: 32px;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        h3 {
            color: #1a1a1a;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 40px;
            font-size: 18px;
            font-weight: 500;
        }

        .mode-selector {
            display: flex;
            gap: 16px;
            margin-bottom: 40px;
            padding: 6px;
            background: #f3f4f6;
            border-radius: 16px;
        }

        .mode-btn {
            flex: 1;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: transparent;
            color: #6b7280;
            font-family: 'Inter', sans-serif;
        }

        .mode-btn:hover {
            color: #1a1a1a;
            background: rgba(255, 255, 255, 0.5);
        }

        .mode-btn.active {
            background: white;
            color: #F45D48;
            box-shadow:
                0 1px 3px rgba(0, 0, 0, 0.1),
                0 1px 2px rgba(0, 0, 0, 0.06);
            transform: none;
        }

        .input-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #1a1a1a;
            font-size: 14px;
            letter-spacing: 0.01em;
        }

        input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Inter', sans-serif;
            transition: all 0.2s ease;
            background: white;
        }

        input:hover {
            border-color: #d1d5db;
        }

        input:focus {
            outline: none;
            border-color: #F45D48;
            box-shadow: 0 0 0 4px rgba(244, 93, 72, 0.1);
        }

        .btn {
            width: 100%;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, #F45D48 0%, #E94B35 100%);
            color: white;
            font-family: 'Inter', sans-serif;
            box-shadow:
                0 4px 6px -1px rgba(244, 93, 72, 0.3),
                0 2px 4px -1px rgba(244, 93, 72, 0.2);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .btn:hover::before {
            opacity: 1;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow:
                0 10px 15px -3px rgba(244, 93, 72, 0.4),
                0 4px 6px -2px rgba(244, 93, 72, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #d1d5db;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn:disabled::before {
            display: none;
        }

        .hidden {
            display: none;
        }

        .question-display {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 40px;
            text-align: center;
            line-height: 1.4;
            letter-spacing: -0.01em;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 32px;
        }

        .answer-btn {
            padding: 24px 20px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            color: #1a1a1a;
            font-family: 'Inter', sans-serif;
            text-align: left;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 16px;
            padding: 2px;
            background: linear-gradient(135deg, #F45D48, #E94B35);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .answer-btn:hover {
            border-color: #F45D48;
            transform: translateY(-2px);
            box-shadow:
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        .answer-btn:hover::before {
            opacity: 1;
        }

        .answer-btn.selected {
            background: linear-gradient(135deg, #F45D48 0%, #E94B35 100%);
            border-color: #F45D48;
            color: white;
            box-shadow:
                0 4px 6px -1px rgba(244, 93, 72, 0.3),
                0 2px 4px -1px rgba(244, 93, 72, 0.2);
        }

        .answer-btn.correct {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-color: #10b981;
            color: white;
            box-shadow:
                0 4px 6px -1px rgba(16, 185, 129, 0.3),
                0 2px 4px -1px rgba(16, 185, 129, 0.2);
        }

        .answer-btn.incorrect {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border-color: #ef4444;
            color: white;
            box-shadow:
                0 4px 6px -1px rgba(239, 68, 68, 0.3),
                0 2px 4px -1px rgba(239, 68, 68, 0.2);
        }

        .answer-btn:disabled {
            cursor: default;
            transform: none;
        }

        .leaderboard {
            margin-top: 32px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            margin-bottom: 8px;
            background: white;
            border: 2px solid #f3f4f6;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.2s ease;
            position: relative;
        }

        .leaderboard-item:hover {
            border-color: #e5e7eb;
            transform: translateX(4px);
        }

        .leaderboard-item.top-3 {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: #fbbf24;
            box-shadow: 0 1px 3px rgba(251, 191, 36, 0.2);
        }

        .rank {
            font-size: 18px;
            font-weight: 700;
            color: #F45D48;
            min-width: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fef2f2;
            border-radius: 8px;
            padding: 4px 8px;
        }

        .leaderboard-item.top-3 .rank {
            background: white;
            color: #f59e0b;
        }

        .player-name {
            flex: 1;
            margin: 0 16px;
            font-size: 16px;
            color: #1a1a1a;
        }

        .score {
            font-size: 18px;
            font-weight: 700;
            color: #1a1a1a;
            background: #f3f4f6;
            padding: 6px 12px;
            border-radius: 8px;
        }

        .leaderboard-item.top-3 .score {
            background: white;
            color: #f59e0b;
        }

        .host-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 32px;
            flex-wrap: wrap;
        }

        .host-controls .btn {
            flex: 1;
            min-width: 140px;
        }

        .question-info {
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 24px;
            padding: 12px 20px;
            background: #f9fafb;
            border-radius: 12px;
            border: 2px solid #f3f4f6;
        }

        .timer-container {
            text-align: center;
            margin-bottom: 32px;
            padding: 24px;
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-radius: 20px;
            border: 2px solid rgba(244, 93, 72, 0.2);
        }

        .timer-display {
            font-size: 64px;
            font-weight: 800;
            color: #F45D48;
            margin-bottom: 16px;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 4px rgba(244, 93, 72, 0.1);
        }

        .timer-display.warning {
            color: #f59e0b;
            animation: pulse 1s ease-in-out infinite;
        }

        .timer-display.danger {
            color: #ef4444;
            animation: pulse 0.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .timer-bar {
            height: 12px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 100px;
            overflow: hidden;
            margin: 0 auto;
            max-width: 100%;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .timer-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981 0%, #F45D48 100%);
            transition: width 0.1s linear;
            border-radius: 100px;
            box-shadow: 0 0 10px rgba(244, 93, 72, 0.5);
        }

        .timer-bar-fill.warning {
            background: linear-gradient(90deg, #f59e0b 0%, #f97316 100%);
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        .timer-bar-fill.danger {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .points-earned {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-top: 16px;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .lobby-screen {
            text-align: center;
        }

        .lobby-title {
            font-size: 36px;
            font-weight: 800;
            color: #1a1a1a;
            margin-bottom: 24px;
            letter-spacing: -0.02em;
        }

        .waiting-message {
            font-size: 18px;
            color: #6b7280;
            margin-bottom: 40px;
            padding: 20px 24px;
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 16px;
            font-weight: 500;
            border: 2px solid #fbbf24;
        }

        .players-list {
            max-width: 500px;
            margin: 0 auto 40px;
        }

        .player-item {
            padding: 16px 20px;
            margin-bottom: 12px;
            background: white;
            border: 2px solid #f3f4f6;
            border-radius: 12px;
            font-weight: 600;
            text-align: center;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.2s ease;
            animation: slideIn 0.3s ease-out;
        }

        .player-item:hover {
            border-color: #e5e7eb;
            transform: translateX(4px);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .remove-player-btn {
            position: absolute;
            right: 12px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.3);
            font-weight: 600;
        }

        .remove-player-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.4);
        }

        .remove-player-btn:active {
            transform: scale(0.95);
        }

        .leaderboard-item {
            position: relative;
        }

        .leaderboard-item .remove-player-btn {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
        }

        .leaderboard-item .remove-player-btn:hover {
            transform: translateY(-50%) scale(1.1);
        }

        .leaderboard-item .remove-player-btn:active {
            transform: translateY(-50%) scale(0.95);
        }

        .final-results {
            text-align: center;
        }

        .podium {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 24px;
            margin: 48px 0;
            height: 350px;
        }

        .podium-place {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            animation: podiumRise 0.6s ease-out backwards;
        }

        .podium-place.first {
            animation-delay: 0.2s;
        }

        .podium-place.second {
            animation-delay: 0s;
        }

        .podium-place.third {
            animation-delay: 0.4s;
        }

        @keyframes podiumRise {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .podium-box {
            width: 140px;
            background: linear-gradient(135deg, #F45D48 0%, #E94B35 100%);
            border-radius: 16px 16px 0 0;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 24px;
            box-shadow: 0 -4px 20px rgba(244, 93, 72, 0.3);
        }

        .podium-place.first .podium-box {
            height: 220px;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1a1a1a;
            box-shadow: 0 -4px 30px rgba(251, 191, 36, 0.5);
        }

        .podium-place.second .podium-box {
            height: 170px;
            background: linear-gradient(135deg, #d1d5db 0%, #9ca3af 100%);
            color: #1a1a1a;
            box-shadow: 0 -4px 20px rgba(209, 213, 219, 0.5);
        }

        .podium-place.third .podium-box {
            height: 140px;
            background: linear-gradient(135deg, #fb923c 0%, #f97316 100%);
            color: #1a1a1a;
            box-shadow: 0 -4px 20px rgba(251, 146, 60, 0.5);
        }

        .podium-medal {
            font-size: 56px;
            margin-bottom: 12px;
            animation: bounce 1s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        .podium-name {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
            word-wrap: break-word;
            max-width: 120px;
        }

        .podium-score {
            font-size: 22px;
            font-weight: 800;
            letter-spacing: -0.01em;
        }

        .host-answer-item {
            padding: 16px 20px;
            margin: 8px 0;
            background: white;
            border: 2px solid #f3f4f6;
            border-radius: 12px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .host-answer-item.correct-answer {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
            font-weight: 700;
            color: #065f46;
        }

        .status-message {
            text-align: center;
            padding: 16px 24px;
            border-radius: 12px;
            margin-bottom: 24px;
            font-weight: 600;
            font-size: 16px;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-message.waiting {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #92400e;
            border: 2px solid #fbbf24;
        }

        .status-message.correct {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            color: #065f46;
            border: 2px solid #10b981;
        }

        .status-message.incorrect {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        .lightning-badge {
            display: inline-block;
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #1a1a1a;
            padding: 8px 20px;
            border-radius: 100px;
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4);
            animation: pulse 2s ease-in-out infinite;
            border: 2px solid #f59e0b;
        }

        .timer-container.lightning {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-color: rgba(251, 191, 36, 0.3);
        }

        .timer-display.lightning {
            color: #f59e0b;
        }

        #final-results-btn {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            box-shadow:
                0 4px 6px -1px rgba(251, 191, 36, 0.4),
                0 2px 4px -1px rgba(251, 191, 36, 0.3);
            animation: pulse 2s ease-in-out infinite;
        }

        #final-results-btn:hover {
            box-shadow:
                0 10px 15px -3px rgba(251, 191, 36, 0.5),
                0 4px 6px -2px rgba(251, 191, 36, 0.4);
        }

        .all-answered-notification {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            animation: slideDown 0.3s ease-out;
            border: 2px solid #10b981;
            text-align: center;
        }

        .all-answered-notification:not(.hidden) {
            display: inline-block;
        }

        .all-answered-notification::before {
            content: '‚úì ';
            font-size: 18px;
            font-weight: 700;
        }

        @media (max-width: 768px) {
            body {
                padding: 24px 16px;
            }

            .card {
                padding: 32px 24px;
                border-radius: 20px;
            }

            h1 {
                font-size: 36px;
            }

            h2 {
                font-size: 24px;
            }

            .question-display {
                font-size: 22px;
                margin-bottom: 32px;
            }

            .answers-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .answer-btn {
                padding: 20px 16px;
            }

            .host-controls {
                flex-direction: column;
            }

            .host-controls .btn {
                width: 100%;
                min-width: unset;
            }

            .timer-display {
                font-size: 48px;
            }

            .timer-container {
                padding: 20px;
            }

            .podium {
                height: 280px;
                gap: 16px;
            }

            .podium-box {
                width: 100px;
                padding: 16px;
            }

            .podium-place.first .podium-box {
                height: 180px;
            }

            .podium-place.second .podium-box {
                height: 140px;
            }

            .podium-place.third .podium-box {
                height: 110px;
            }

            .podium-medal {
                font-size: 40px;
            }

            .podium-name {
                font-size: 14px;
                max-width: 90px;
            }

            .podium-score {
                font-size: 18px;
            }
        }

        @media (max-width: 480px) {
            .card {
                padding: 24px 20px;
            }

            h1 {
                font-size: 32px;
            }

            .mode-selector {
                gap: 12px;
            }

            .mode-btn {
                padding: 14px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="setup-screen" class="card">
            <h1>üé§ Pop Culture Trivia</h1>
            <p class="subtitle">Real-time multiplayer pop culture game</p>

            <div class="mode-selector">
                <button class="mode-btn active" onclick="selectMode('player')">Join as Player</button>
                <button class="mode-btn" onclick="selectMode('host')">Host Game</button>
            </div>

            <div id="player-setup">
                <div class="input-group">
                    <label for="player-name">Your Name</label>
                    <input type="text" id="player-name" placeholder="Enter your name" maxlength="20">
                </div>
                <button class="btn" onclick="joinGame()">Join Game</button>
            </div>

            <div id="host-setup" class="hidden">
                <div class="input-group">
                    <label for="host-code">Host Code</label>
                    <input type="password" id="host-code" placeholder="Enter host code">
                </div>
                <button class="btn" onclick="startAsHost()">Start Hosting</button>
            </div>
        </div>

        <div id="game-screen" class="card hidden">
            <!-- Lobby Screen -->
            <div id="lobby-view" class="lobby-screen">
                <h2 class="lobby-title">Game Lobby</h2>
                <div class="waiting-message">
                    <span id="lobby-message">Waiting for host to start the game...</span>
                </div>
                <div class="players-list">
                    <h3>Players Joined</h3>
                    <div id="lobby-players-list"></div>
                </div>
                <div id="host-lobby-controls" class="hidden">
                    <button class="btn" onclick="startGame()">Start Game</button>
                </div>
            </div>

            <!-- Playing Screen -->
            <div id="playing-view" class="hidden">
                <div id="player-game-view">
                    <div id="lightning-badge-container" style="text-align: center;" class="hidden">
                        <span class="lightning-badge">‚ö° LIGHTNING ROUND ‚ö°</span>
                    </div>
                    <h2>Question <span id="question-number">1</span></h2>

                    <div class="timer-container" id="timer-container-player">
                        <div id="timer-display" class="timer-display">20</div>
                        <div class="timer-bar">
                            <div id="timer-bar-fill" class="timer-bar-fill" style="width: 100%"></div>
                        </div>
                    </div>

                    <div id="status-message" class="status-message waiting hidden">
                        Waiting for next question...
                    </div>

                    <div id="points-earned" class="points-earned hidden"></div>

                    <div id="question-display" class="question-display"></div>

                    <div id="answers-container" class="answers-grid"></div>

                    <div id="player-leaderboard" class="leaderboard">
                        <h3>Leaderboard</h3>
                        <div id="player-leaderboard-list"></div>
                    </div>
                </div>

                <div id="host-game-view" class="hidden">
                    <div id="host-lightning-badge-container" style="text-align: center;" class="hidden">
                        <span class="lightning-badge">‚ö° LIGHTNING ROUND ‚ö°</span>
                    </div>
                    <h2>Host Controls</h2>

                    <div id="all-answered-notification" class="all-answered-notification hidden">
                        All players have answered! Ready to continue.
                    </div>

                    <div class="question-info">
                        Question <span id="host-question-number">1</span> of <span id="total-questions">40</span>
                    </div>

                    <div class="host-controls">
                        <button class="btn" onclick="previousQuestion()" id="prev-btn">‚Üê Previous</button>
                        <button class="btn" onclick="nextQuestion()" id="next-btn">Next ‚Üí</button>
                        <button class="btn" onclick="revealAnswer()" id="reveal-btn">Reveal Answer</button>
                        <button class="btn hidden" onclick="showFinalResults()" id="final-results-btn">üèÜ See Final Results</button>
                        <button class="btn" onclick="restartGame()" id="restart-btn">Restart Game</button>
                    </div>

                    <div id="host-question-display" class="question-display"></div>

                    <div id="host-answers-display"></div>

                    <div id="host-leaderboard" class="leaderboard">
                        <h3>Leaderboard</h3>
                        <div id="host-leaderboard-list"></div>
                    </div>
                </div>
            </div>

            <!-- Final Results Screen -->
            <div id="final-view" class="final-results hidden">
                <h2>üéâ Final Results üéâ</h2>

                <div class="podium" id="podium-display"></div>

                <div class="leaderboard">
                    <h3>Final Standings</h3>
                    <div id="final-leaderboard-list"></div>
                </div>

                <div id="host-final-controls" class="hidden" style="margin-top: 30px;">
                    <button class="btn" onclick="restartGame()">Play Again</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyBPqQ0FRwo2b2o4Pyu6yiyJNWFrU0rZFKo",
            authDomain: "fbos-trivia.firebaseapp.com",
            databaseURL: "https://fbos-trivia-default-rtdb.firebaseio.com",
            projectId: "fbos-trivia",
            storageBucket: "fbos-trivia.firebasestorage.app",
            messagingSenderId: "155420030356",
            appId: "1:155420030356:web:020161ff0c2c992c6e4b81"
        };

        // Import Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, onValue, update, push, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // TRIVIA QUESTIONS
        const QUESTION_TIME_LIMIT = 20; // seconds
        const LIGHTNING_ROUND_TIME_LIMIT = 10; // seconds for lightning round
        const MAX_POINTS = 1000;
        const LIGHTNING_ROUND_START = 30; // Question 31 starts lightning round

        const questions = [
            // STRANGER THINGS (10 questions)
            {
                question: "What is Eleven's favorite food?",
                answers: ["Pizza", "Eggo Waffles", "Ice Cream", "Hamburgers"],
                correct: 1
            },
            {
                question: "What year did the first season of Stranger Things take place?",
                answers: ["1981", "1983", "1985", "1987"],
                correct: 1
            },
            {
                question: "What is the name of the alternate dimension in Stranger Things?",
                answers: ["The Shadow Realm", "The Upside Down", "The Dark Place", "The Other Side"],
                correct: 1
            },
            {
                question: "What game do the kids frequently play?",
                answers: ["Monopoly", "Chess", "Dungeons & Dragons", "Risk"],
                correct: 2
            },
            {
                question: "What is the name of the town where Stranger Things takes place?",
                answers: ["Hawkins, Indiana", "Derry, Maine", "Twin Peaks, Washington", "Riverdale, New York"],
                correct: 0
            },
            {
                question: "Which character works at Scoops Ahoy ice cream shop?",
                answers: ["Jonathan", "Steve", "Billy", "Lucas"],
                correct: 1
            },
            {
                question: "What is Chief Hopper's daughter's name?",
                answers: ["Susan", "Sarah", "Sally", "Samantha"],
                correct: 1
            },
            {
                question: "Who is Eleven's biological mother?",
                answers: ["Joyce Byers", "Karen Wheeler", "Terry Ives", "Claudia Henderson"],
                correct: 2
            },
            {
                question: "What is Dustin's pet from the Upside Down called?",
                answers: ["Dart", "Demo", "Shadow", "Spike"],
                correct: 0
            },
            {
                question: "Which Stranger Things character says 'Friends don't lie'?",
                answers: ["Mike", "Will", "Eleven", "Dustin"],
                correct: 2
            },

            // POP CULTURE (10 questions)
            {
                question: "Which social media platform was known for 6-second videos?",
                answers: ["Vine", "TikTok", "Snapchat", "Instagram"],
                correct: 0
            },
            {
                question: "What Marvel movie features the line 'I am inevitable'?",
                answers: ["Infinity War", "Endgame", "Thor: Ragnarok", "Civil War"],
                correct: 1
            },
            {
                question: "Which streaming service is known for the 'Netflix and chill' meme?",
                answers: ["Hulu", "Netflix", "Disney+", "HBO Max"],
                correct: 1
            },
            {
                question: "Who hosted The Tonight Show before Jimmy Fallon?",
                answers: ["Conan O'Brien", "David Letterman", "Jay Leno", "Jimmy Kimmel"],
                correct: 2
            },
            {
                question: "What year did the iPhone first release?",
                answers: ["2005", "2007", "2009", "2011"],
                correct: 1
            },
            {
                question: "Which reality TV show features the phrase 'The tribe has spoken'?",
                answers: ["Big Brother", "The Amazing Race", "Survivor", "Fear Factor"],
                correct: 2
            },
            {
                question: "What is the most-watched video on YouTube?",
                answers: ["Baby Shark", "Despacito", "Gangnam Style", "Shape of You"],
                correct: 0
            },
            {
                question: "Which celebrity couple was nicknamed 'Bennifer'?",
                answers: ["Brad Pitt & Jennifer Aniston", "Ben Affleck & Jennifer Lopez", "Ben Stiller & Jennifer Garner", "Benedict Cumberbatch & Jennifer Lawrence"],
                correct: 1
            },
            {
                question: "What is the name of Kim Kardashian's first child?",
                answers: ["Saint", "Chicago", "North", "Psalm"],
                correct: 2
            },
            {
                question: "Which app was acquired by Facebook in 2012 for $1 billion?",
                answers: ["Snapchat", "WhatsApp", "Instagram", "TikTok"],
                correct: 2
            },

            // FAST FOOD (10 questions)
            {
                question: "What fast food chain has the slogan 'Have It Your Way'?",
                answers: ["McDonald's", "Wendy's", "Burger King", "Five Guys"],
                correct: 2
            },
            {
                question: "Which fast food chain is known for their square hamburgers?",
                answers: ["White Castle", "Wendy's", "Krystal", "Shake Shack"],
                correct: 1
            },
            {
                question: "What is Taco Bell's signature sauce called?",
                answers: ["Baja Sauce", "Fire Sauce", "Diablo Sauce", "All of these"],
                correct: 3
            },
            {
                question: "Which fast food restaurant was founded first?",
                answers: ["McDonald's", "Burger King", "KFC", "White Castle"],
                correct: 3
            },
            {
                question: "What is the name of McDonald's famous clown mascot?",
                answers: ["Ronald McDonald", "Grimace", "Hamburglar", "Mayor McCheese"],
                correct: 0
            },
            {
                question: "Which fast food chain uses the slogan 'Eat Fresh'?",
                answers: ["Subway", "Quiznos", "Jimmy John's", "Panera"],
                correct: 0
            },
            {
                question: "What is Chick-fil-A's signature sandwich made with?",
                answers: ["Beef", "Turkey", "Chicken", "Fish"],
                correct: 2
            },
            {
                question: "Which pizza chain's mascot is 'The Noid'?",
                answers: ["Pizza Hut", "Domino's", "Little Caesars", "Papa John's"],
                correct: 1
            },
            {
                question: "What fast food chain serves the 'Baconator'?",
                answers: ["Burger King", "Five Guys", "Wendy's", "Carl's Jr."],
                correct: 2
            },
            {
                question: "Which day is Chick-fil-A famously closed?",
                answers: ["Monday", "Saturday", "Sunday", "Friday"],
                correct: 2
            },

            // THE MIDDLE (10 questions)
            {
                question: "What is the last name of the family in The Middle?",
                answers: ["Heck", "Miller", "Johnson", "Smith"],
                correct: 0
            },
            {
                question: "Which state does The Middle take place in?",
                answers: ["Illinois", "Ohio", "Indiana", "Michigan"],
                correct: 2
            },
            {
                question: "What is Brick's unusual habit?",
                answers: ["Eating dirt", "Whispering to himself", "Collecting rocks", "Walking backwards"],
                correct: 1
            },
            {
                question: "What is Frankie's job?",
                answers: ["Teacher", "Car salesman", "Dentist", "Nurse"],
                correct: 1
            },
            {
                question: "What is Axl's middle name?",
                answers: ["Redford", "Robert", "Richard", "Raymond"],
                correct: 0
            },
            {
                question: "Who is Sue's best friend?",
                answers: ["Carly", "April", "Darrin", "Brad"],
                correct: 0
            },
            {
                question: "What is Mike's profession?",
                answers: ["Accountant", "Manager at a quarry", "Police officer", "Construction worker"],
                correct: 1
            },
            {
                question: "What is the name of the town where the Hecks live?",
                answers: ["Middleton", "Orson", "Smallville", "Springfield"],
                correct: 1
            },
            {
                question: "How many seasons did The Middle run?",
                answers: ["7", "8", "9", "10"],
                correct: 2
            },
            {
                question: "What activity is Sue always trying out for but rarely succeeds at?",
                answers: ["Sports teams", "School plays", "Cheerleading", "All of these"],
                correct: 3
            }
        ];

        // Global state
        let currentMode = 'player';
        let playerId = null;
        let playerName = null;
        let isHost = false;
        let hasAnswered = false;
        let questionStartTime = null;
        let timerInterval = null;

        // Mode selection
        window.selectMode = function(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            if (mode === 'player') {
                document.getElementById('player-setup').classList.remove('hidden');
                document.getElementById('host-setup').classList.add('hidden');
            } else {
                document.getElementById('player-setup').classList.add('hidden');
                document.getElementById('host-setup').classList.remove('hidden');
            }
        };

        // Join as player
        window.joinGame = function() {
            const nameInput = document.getElementById('player-name');
            playerName = nameInput.value.trim();

            if (!playerName) {
                alert('Please enter your name');
                return;
            }

            playerId = 'player_' + Date.now();

            // Add player to database
            set(ref(database, 'players/' + playerId), {
                name: playerName,
                score: 0,
                joinedAt: Date.now()
            });

            // Initialize game state if needed
            const gameStateRef = ref(database, 'gameState');
            onValue(gameStateRef, (snapshot) => {
                if (!snapshot.exists()) {
                    set(gameStateRef, {
                        status: 'lobby', // lobby, playing, finished
                        currentQuestion: 0,
                        showAnswer: false,
                        totalQuestions: questions.length
                    });
                }
            }, { onlyOnce: true });

            showGameScreen();
            setupPlayerListeners();
        };

        // Start as host
        window.startAsHost = function() {
            const codeInput = document.getElementById('host-code');
            const code = codeInput.value.trim();

            if (code !== 'host123') {
                alert('Incorrect host code');
                return;
            }

            isHost = true;
            playerName = 'Host';

            // Reset game state to lobby
            set(ref(database, 'gameState'), {
                status: 'lobby',
                currentQuestion: 0,
                showAnswer: false,
                totalQuestions: questions.length
            });

            showGameScreen();
            setupHostListeners();
        };

        // Start the game (host only)
        window.startGame = function() {
            if (!isHost) return;

            update(ref(database, 'gameState'), {
                status: 'playing'
            });
        };

        // Restart game (host only)
        window.restartGame = function() {
            if (!isHost) return;

            // Reset all player scores
            const playersRef = ref(database, 'players');
            onValue(playersRef, (snapshot) => {
                const players = snapshot.val();
                if (players) {
                    Object.keys(players).forEach(playerId => {
                        update(ref(database, 'players/' + playerId), {
                            score: 0
                        });
                    });
                }
            }, { onlyOnce: true });

            // Reset game state to lobby
            update(ref(database, 'gameState'), {
                status: 'lobby',
                currentQuestion: 0,
                showAnswer: false
            });
        };

        function showGameScreen() {
            document.getElementById('setup-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('total-questions').textContent = questions.length;
        }

        function setupPlayerListeners() {
            // Listen for game state changes
            const gameStateRef = ref(database, 'gameState');
            onValue(gameStateRef, (snapshot) => {
                const gameState = snapshot.val();
                if (gameState) {
                    updateGameView(gameState);
                }
            });

            // Listen for players in lobby
            const playersRef = ref(database, 'players');
            onValue(playersRef, (snapshot) => {
                updateLobbyPlayers(snapshot.val());
                updateLeaderboard(snapshot.val(), 'player-leaderboard-list');
                updateLeaderboard(snapshot.val(), 'final-leaderboard-list');
            });
        }

        function setupHostListeners() {
            // Listen for game state to update display
            const gameStateRef = ref(database, 'gameState');
            onValue(gameStateRef, (snapshot) => {
                const gameState = snapshot.val();
                if (gameState) {
                    updateGameView(gameState);
                }
            });

            // Listen for players and leaderboard changes
            const playersRef = ref(database, 'players');
            onValue(playersRef, (snapshot) => {
                updateLobbyPlayers(snapshot.val());
                updateLeaderboard(snapshot.val(), 'host-leaderboard-list');
                updateLeaderboard(snapshot.val(), 'final-leaderboard-list');
                updatePodium(snapshot.val());

                // Check if all players have answered (for host notification)
                // Only check if answer has NOT been revealed yet
                const gameStateRef = ref(database, 'gameState');
                onValue(gameStateRef, (gameStateSnapshot) => {
                    const gameState = gameStateSnapshot.val();
                    if (gameState && gameState.status === 'playing' && !gameState.showAnswer) {
                        checkAllPlayersAnsweredRealtime(snapshot.val(), gameState.currentQuestion);
                    }
                }, { onlyOnce: true });
            });
        }

        function checkAllPlayersAnsweredRealtime(players, currentQuestionIndex) {
            const notification = document.getElementById('all-answered-notification');

            // Always hide notification if conditions aren't met
            if (!players || !notification) {
                if (notification) notification.classList.add('hidden');
                return;
            }

            const playerArray = Object.values(players);

            // Need at least one player to show notification
            if (playerArray.length === 0) {
                notification.classList.add('hidden');
                return;
            }

            // Count how many players have answered the current question
            let answeredCount = 0;
            for (const player of playerArray) {
                if (player.answeredQuestion === currentQuestionIndex) {
                    answeredCount++;
                }
            }

            // Only show if ALL players have answered
            if (answeredCount === playerArray.length && answeredCount > 0) {
                notification.classList.remove('hidden');
            } else {
                notification.classList.add('hidden');
            }
        }

        function updateGameView(gameState) {
            const status = gameState.status || 'lobby';

            // Show/hide views based on game status
            document.getElementById('lobby-view').classList.toggle('hidden', status !== 'lobby');
            document.getElementById('playing-view').classList.toggle('hidden', status !== 'playing');
            document.getElementById('final-view').classList.toggle('hidden', status !== 'finished');

            // Show appropriate controls for host
            if (isHost) {
                document.getElementById('host-lobby-controls').classList.toggle('hidden', status !== 'lobby');
                document.getElementById('host-final-controls').classList.toggle('hidden', status !== 'finished');
                document.getElementById('player-game-view').classList.add('hidden');
                document.getElementById('host-game-view').classList.toggle('hidden', status !== 'playing');
            } else {
                document.getElementById('host-lobby-controls').classList.add('hidden');
                document.getElementById('host-final-controls').classList.add('hidden');
                document.getElementById('player-game-view').classList.toggle('hidden', status !== 'playing');
                document.getElementById('host-game-view').classList.add('hidden');
            }

            // Update views based on status
            if (status === 'playing') {
                if (isHost) {
                    updateHostView(gameState);
                } else {
                    updatePlayerView(gameState);
                }
            }
        }

        function updateLobbyPlayers(players) {
            const lobbyList = document.getElementById('lobby-players-list');
            if (!lobbyList) return;

            lobbyList.innerHTML = '';

            if (!players) {
                lobbyList.innerHTML = '<div class="player-item">No players yet</div>';
                return;
            }

            const playerArray = Object.entries(players).map(([id, data]) => ({
                id,
                name: data.name
            }));

            playerArray.forEach(player => {
                const item = document.createElement('div');
                item.className = 'player-item';

                const nameSpan = document.createElement('span');
                nameSpan.textContent = player.name;
                item.appendChild(nameSpan);

                // Add remove button for host
                if (isHost) {
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-player-btn';
                    removeBtn.innerHTML = '√ó';
                    removeBtn.title = 'Remove player';
                    removeBtn.onclick = () => removePlayer(player.id);
                    item.appendChild(removeBtn);
                }

                lobbyList.appendChild(item);
            });
        }

        window.removePlayer = function(playerId) {
            if (!isHost) return;

            if (confirm('Remove this player from the game?')) {
                remove(ref(database, 'players/' + playerId));
            }
        };

        function updatePlayerView(gameState) {
            const questionIndex = gameState.currentQuestion;
            const question = questions[questionIndex];
            const isLastQuestion = questionIndex >= questions.length - 1;

            // Show lightning badge if in lightning round
            const lightningBadgeContainer = document.getElementById('lightning-badge-container');
            const timerContainer = document.getElementById('timer-container-player');
            const isLightningRound = questionIndex >= LIGHTNING_ROUND_START;

            if (isLightningRound) {
                lightningBadgeContainer.classList.remove('hidden');
                timerContainer.classList.add('lightning');
            } else {
                lightningBadgeContainer.classList.add('hidden');
                timerContainer.classList.remove('lightning');
            }

            document.getElementById('question-number').textContent = questionIndex + 1;
            document.getElementById('question-display').textContent = question.question;

            const answersContainer = document.getElementById('answers-container');
            const statusMessage = document.getElementById('status-message');

            // Show waiting message after last question is answered
            if (isLastQuestion && gameState.showAnswer) {
                statusMessage.classList.remove('hidden', 'correct', 'incorrect');
                statusMessage.classList.add('waiting');
                statusMessage.textContent = 'üèÜ Waiting for host to reveal final results...';
            }

            // Reset answered state when question changes
            if (!hasAnswered || gameState.showAnswer === false) {
                if (gameState.showAnswer === false) {
                    hasAnswered = false;
                    statusMessage.classList.add('hidden');
                    document.getElementById('points-earned').classList.add('hidden');

                    // Start timer for new question
                    startQuestionTimer(questionIndex);
                }

                answersContainer.innerHTML = '';
                question.answers.forEach((answer, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'answer-btn';
                    btn.textContent = String.fromCharCode(65 + index) + '. ' + answer;
                    btn.onclick = () => selectAnswer(index, question.correct, questionIndex);

                    if (gameState.showAnswer) {
                        btn.disabled = true;
                        if (index === question.correct) {
                            btn.classList.add('correct');
                        }
                    }

                    answersContainer.appendChild(btn);
                });
            }
        }

        function startQuestionTimer(questionIndex = 0) {
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }

            questionStartTime = Date.now();
            const timerDisplay = document.getElementById('timer-display');
            const timerBarFill = document.getElementById('timer-bar-fill');

            // Use lightning round time if in lightning round (questions 30+)
            const timeLimit = questionIndex >= LIGHTNING_ROUND_START ? LIGHTNING_ROUND_TIME_LIMIT : QUESTION_TIME_LIMIT;

            timerInterval = setInterval(() => {
                const elapsed = (Date.now() - questionStartTime) / 1000;
                const remaining = Math.max(0, timeLimit - elapsed);
                const percentage = (remaining / timeLimit) * 100;

                timerDisplay.textContent = Math.ceil(remaining);
                timerBarFill.style.width = percentage + '%';

                // Update colors based on time remaining
                timerDisplay.classList.remove('warning', 'danger');
                timerBarFill.classList.remove('warning', 'danger');

                if (remaining <= 5) {
                    timerDisplay.classList.add('danger');
                    timerBarFill.classList.add('danger');
                } else if (remaining <= 10) {
                    timerDisplay.classList.add('warning');
                    timerBarFill.classList.add('warning');
                }

                if (remaining === 0) {
                    clearInterval(timerInterval);
                }
            }, 100);
        }

        function stopQuestionTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        window.selectAnswer = function(answerIndex, correctIndex, questionIndex) {
            if (hasAnswered) return;

            hasAnswered = true;
            stopQuestionTimer();

            const isCorrect = answerIndex === correctIndex;

            // Calculate points based on time (Kahoot-style)
            let pointsEarned = 0;
            if (isCorrect && questionStartTime) {
                const timeElapsed = (Date.now() - questionStartTime) / 1000;
                // Use appropriate time limit for scoring
                const timeLimit = questionIndex >= LIGHTNING_ROUND_START ? LIGHTNING_ROUND_TIME_LIMIT : QUESTION_TIME_LIMIT;
                // Points decrease over time: 1000 points for instant, down to 500 at time limit
                const timePercentage = Math.min(timeElapsed / timeLimit, 1);
                pointsEarned = Math.round(MAX_POINTS - (timePercentage * 500));
                pointsEarned = Math.max(pointsEarned, 0);
            }

            // Update UI
            const buttons = document.querySelectorAll('.answer-btn');
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === answerIndex) {
                    btn.classList.add(isCorrect ? 'correct' : 'incorrect');
                }
            });

            // Show status message and points
            const statusMessage = document.getElementById('status-message');
            statusMessage.classList.remove('hidden', 'waiting', 'correct', 'incorrect');
            statusMessage.classList.add(isCorrect ? 'correct' : 'incorrect');
            statusMessage.textContent = isCorrect ? '‚úì Correct!' : '‚úó Incorrect';

            if (isCorrect && pointsEarned > 0) {
                const pointsDisplay = document.getElementById('points-earned');
                pointsDisplay.textContent = '+' + pointsEarned + ' points';
                pointsDisplay.classList.remove('hidden');
            }

            // Update score and answered status in database
            if (playerId) {
                const playerRef = ref(database, 'players/' + playerId);
                onValue(playerRef, (snapshot) => {
                    const playerData = snapshot.val();
                    if (playerData) {
                        const updateData = {
                            answeredQuestion: questionIndex
                        };
                        if (isCorrect && pointsEarned > 0) {
                            updateData.score = (playerData.score || 0) + pointsEarned;
                        }
                        update(ref(database, 'players/' + playerId), updateData);
                    }
                }, { onlyOnce: true });
            }
        };

        function updateHostView(gameState) {
            const questionIndex = gameState.currentQuestion;
            const question = questions[questionIndex];

            // Show lightning badge if in lightning round
            const hostLightningBadgeContainer = document.getElementById('host-lightning-badge-container');
            const isLightningRound = questionIndex >= LIGHTNING_ROUND_START;

            if (isLightningRound) {
                hostLightningBadgeContainer.classList.remove('hidden');
            } else {
                hostLightningBadgeContainer.classList.add('hidden');
            }

            // Always start with notification hidden, will be shown if conditions are met
            const notification = document.getElementById('all-answered-notification');
            if (notification && !gameState.showAnswer) {
                notification.classList.add('hidden');
            }

            document.getElementById('host-question-number').textContent = questionIndex + 1;
            document.getElementById('host-question-display').textContent = question.question;

            const answersDisplay = document.getElementById('host-answers-display');
            answersDisplay.innerHTML = '<div style="margin-top: 20px;">';
            question.answers.forEach((answer, index) => {
                const isCorrect = index === question.correct;
                const letter = String.fromCharCode(65 + index);
                const itemClass = (gameState.showAnswer && isCorrect) ? 'host-answer-item correct-answer' : 'host-answer-item';
                answersDisplay.innerHTML += `
                    <div class="${itemClass}">
                        ${letter}. ${answer} ${gameState.showAnswer && isCorrect ? '‚úì' : ''}
                    </div>
                `;
            });
            answersDisplay.innerHTML += '</div>';

            // Update button states
            const isLastQuestion = questionIndex >= questions.length - 1;
            document.getElementById('prev-btn').disabled = questionIndex === 0;
            document.getElementById('next-btn').disabled = isLastQuestion;
            document.getElementById('reveal-btn').disabled = gameState.showAnswer;

            // Show "See Final Results" button only on last question
            const finalResultsBtn = document.getElementById('final-results-btn');
            if (isLastQuestion) {
                finalResultsBtn.classList.remove('hidden');
            } else {
                finalResultsBtn.classList.add('hidden');
            }
        }


        window.nextQuestion = function() {
            // Hide the all-answered notification when moving to next question
            const notification = document.getElementById('all-answered-notification');
            if (notification) {
                notification.classList.add('hidden');
            }

            const gameStateRef = ref(database, 'gameState');
            onValue(gameStateRef, (snapshot) => {
                const gameState = snapshot.val();
                if (gameState && gameState.currentQuestion < questions.length - 1) {
                    update(gameStateRef, {
                        currentQuestion: gameState.currentQuestion + 1,
                        showAnswer: false
                    });
                }
            }, { onlyOnce: true });
        };

        window.showFinalResults = function() {
            if (!isHost) return;

            const gameStateRef = ref(database, 'gameState');
            update(gameStateRef, {
                status: 'finished'
            });
        };

        window.previousQuestion = function() {
            // Hide the all-answered notification when moving to previous question
            const notification = document.getElementById('all-answered-notification');
            if (notification) {
                notification.classList.add('hidden');
            }

            const gameStateRef = ref(database, 'gameState');
            onValue(gameStateRef, (snapshot) => {
                const gameState = snapshot.val();
                if (gameState && gameState.currentQuestion > 0) {
                    update(gameStateRef, {
                        currentQuestion: gameState.currentQuestion - 1,
                        showAnswer: false
                    });
                }
            }, { onlyOnce: true });
        };

        window.revealAnswer = function() {
            // Hide notification when revealing answer
            const notification = document.getElementById('all-answered-notification');
            if (notification) {
                notification.classList.add('hidden');
            }

            const gameStateRef = ref(database, 'gameState');
            update(gameStateRef, {
                showAnswer: true
            });
        };

        function updateLeaderboard(players, elementId) {
            if (!players) return;

            const playerArray = Object.entries(players).map(([id, data]) => ({
                id,
                name: data.name,
                score: data.score || 0
            }));

            playerArray.sort((a, b) => b.score - a.score);

            const listElement = document.getElementById(elementId);
            if (!listElement) return;
            listElement.innerHTML = '';

            // Check if this is the host leaderboard during gameplay
            const showRemoveButton = isHost && elementId === 'host-leaderboard-list';

            playerArray.forEach((player, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item' + (index < 3 ? ' top-3' : '');
                item.innerHTML = `
                    <span class="rank">#${index + 1}</span>
                    <span class="player-name">${player.name}</span>
                    <span class="score">${player.score.toLocaleString()} pts</span>
                `;

                // Add remove button for host
                if (showRemoveButton) {
                    const removeBtn = document.createElement('button');
                    removeBtn.className = 'remove-player-btn';
                    removeBtn.innerHTML = '√ó';
                    removeBtn.title = 'Remove player';
                    removeBtn.onclick = () => removePlayer(player.id);
                    item.appendChild(removeBtn);
                }

                listElement.appendChild(item);
            });
        }

        function updatePodium(players) {
            const podiumDisplay = document.getElementById('podium-display');
            if (!podiumDisplay || !players) return;

            const playerArray = Object.entries(players).map(([id, data]) => ({
                id,
                name: data.name,
                score: data.score || 0
            }));

            playerArray.sort((a, b) => b.score - a.score);

            // Get top 3
            const top3 = playerArray.slice(0, 3);

            if (top3.length === 0) return;

            // Create podium display (2nd, 1st, 3rd order)
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            const classes = ['first', 'second', 'third'];

            podiumDisplay.innerHTML = '';

            // Display in order: 2nd, 1st, 3rd for visual podium effect
            const displayOrder = top3.length >= 2 ? [1, 0, 2] : [0];

            displayOrder.forEach(index => {
                if (top3[index]) {
                    const player = top3[index];
                    const podiumPlace = document.createElement('div');
                    podiumPlace.className = `podium-place ${classes[index]}`;
                    podiumPlace.innerHTML = `
                        <div class="podium-medal">${medals[index]}</div>
                        <div class="podium-box">
                            <div class="podium-name">${player.name}</div>
                            <div class="podium-score">${player.score.toLocaleString()} pts</div>
                        </div>
                    `;
                    podiumDisplay.appendChild(podiumPlace);
                }
            });
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (playerId) {
                remove(ref(database, 'players/' + playerId));
            }
        });
    </script>
</body>
</html>